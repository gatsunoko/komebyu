syntax = "proto3";

import "google/protobuf/wrappers.proto";

package dwango.nicolive.chat.service.edge;

message ChunkedEntry {
  // Some NDGR servers emit entries using field #2 instead of #1.
  // Keep both for compatibility with live (field #2) and legacy (field #1).
  repeated Entry entry = 1;
  repeated Entry entries = 2;
}

message Entry {
  oneof payload {
    Segment segment = 1;
    Next next = 2;
    Previous previous = 3;
    Reconnect reconnect = 4;
    Ping ping = 5;
    History history = 6;
  }
}

message Segment {
  google.protobuf.Int64Value from = 1;
  google.protobuf.Int64Value until = 2;
  string uri = 3;
  google.protobuf.Int64Value reconnectAt = 4;
}

message Next {
  google.protobuf.Int64Value at = 1;
  bytes cursor = 2;
  string uri = 3;
}

message Previous {
  google.protobuf.Int64Value at = 1;
  bytes cursor = 2;
  string uri = 3;
}

message Reconnect {
  google.protobuf.Int64Value at = 1;
  string streamUrl = 2;
  bytes cursor = 3;
  google.protobuf.Int64Value reconnectAt = 4;
}

message Ping {}
message History {}

message ChunkedMessage {
  repeated Message message = 1;
}

message Message {
  oneof payload {
    Chat chat = 1;
    Reconnect reconnect = 2;
    Statistics statistics = 3;
    Ping ping = 4;
    End end = 5;
  }
}

message Chat {
  string roomName = 1;
  string threadId = 2;
  int64 no = 3;
  int64 vpos = 4;
  string content = 5;
  string userId = 6;
  string name = 7;
  string mail = 8;
  bool anonymous = 9;
}

message Statistics {
  uint64 watchCount = 1;
  uint64 commentCount = 2;
}

message End {}
